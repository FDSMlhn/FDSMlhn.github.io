<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/css/main.css?v=7.1.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.2">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.2" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="I see one of the im2col implement in Python as following in the Assignment2 of CS231n:">
<meta name="keywords" content="hexo">
<meta property="og:type" content="article">
<meta property="og:title" content="Understanding im2col implementation in Python(numpy fancy indexing)">
<meta property="og:url" content="http://fdsmlhn.github.io/2017/11/02/Understanding im2col implementation in Python(numpy fancy indexing)/index.html">
<meta property="og:site_name" content="Nevermore">
<meta property="og:description" content="I see one of the im2col implement in Python as following in the Assignment2 of CS231n:">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-11-04T19:20:41.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Understanding im2col implementation in Python(numpy fancy indexing)">
<meta name="twitter:description" content="I see one of the im2col implement in Python as following in the Assignment2 of CS231n:">





  
  
  <link rel="canonical" href="http://fdsmlhn.github.io/2017/11/02/Understanding im2col implementation in Python(numpy fancy indexing)/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Understanding im2col implementation in Python(numpy fancy indexing) | Nevermore</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Nevermore</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Just begins.</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fdsmlhn.github.io/2017/11/02/Understanding im2col implementation in Python(numpy fancy indexing)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Haonan Li">
      <meta itemprop="description" content="Strong Mind = Success">
      <meta itemprop="image" content="/images/selfie1.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nevermore">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Understanding im2col implementation in Python(numpy fancy indexing)

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-11-02 00:00:00" itemprop="dateCreated datePublished" datetime="2017-11-02T00:00:00-07:00">2017-11-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-11-04 12:20:41" itemprop="dateModified" datetime="2017-11-04T12:20:41-07:00">2017-11-04</time>
              
            
          </span>

          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2017/11/02/Understanding im2col implementation in Python(numpy fancy indexing)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/11/02/Understanding im2col implementation in Python(numpy fancy indexing)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
            <span id="/2017/11/02/Understanding im2col implementation in Python(numpy fancy indexing)/" class="leancloud_visitors" data-flag-title="Understanding im2col implementation in Python(numpy fancy indexing)">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <hr>
<p>I see one of the im2col implement in Python as following in the Assignment2 of CS231n: <a id="more"></a> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_im2col_indices</span><span class="params">(x_shape, field_height, field_width, padding=<span class="number">1</span>, stride=<span class="number">1</span>)</span>:</span></span><br><span class="line">    <span class="comment"># First figure out what the size of the output should be</span></span><br><span class="line">    N, C, H, W = x_shape</span><br><span class="line">    <span class="keyword">assert</span> (H + <span class="number">2</span> * padding - field_height) % stride == <span class="number">0</span></span><br><span class="line">    <span class="keyword">assert</span> (W + <span class="number">2</span> * padding - field_height) % stride == <span class="number">0</span></span><br><span class="line">    out_height = (H + <span class="number">2</span> * padding - field_height) / stride + <span class="number">1</span></span><br><span class="line">    out_width = (W + <span class="number">2</span> * padding - field_width) / stride + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    i0 = np.repeat(np.arange(field_height), field_width)</span><br><span class="line">    i0 = np.tile(i0, C)</span><br><span class="line">    i1 = stride * np.repeat(np.arange(out_height), out_width)</span><br><span class="line">    j0 = np.tile(np.arange(field_width), field_height * C)</span><br><span class="line">    j1 = stride * np.tile(np.arange(out_width), out_height)</span><br><span class="line">    i = i0.reshape(<span class="number">-1</span>, <span class="number">1</span>) + i1.reshape(<span class="number">1</span>, <span class="number">-1</span>)</span><br><span class="line">    j = j0.reshape(<span class="number">-1</span>, <span class="number">1</span>) + j1.reshape(<span class="number">1</span>, <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    k = np.repeat(np.arange(C), field_height * field_width).reshape(<span class="number">-1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (k, i, j)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">im2col_indices</span><span class="params">(x, field_height, field_width, padding=<span class="number">1</span>, stride=<span class="number">1</span>)</span>:</span></span><br><span class="line">    <span class="string">""" An implementation of im2col based on some fancy indexing """</span></span><br><span class="line">    <span class="comment"># Zero-pad the input</span></span><br><span class="line">    p = padding</span><br><span class="line">    x_padded = np.pad(x, ((<span class="number">0</span>, <span class="number">0</span>), (<span class="number">0</span>, <span class="number">0</span>), (p, p), (p, p)), mode=<span class="string">'constant'</span>)</span><br><span class="line"></span><br><span class="line">    k, i, j = get_im2col_indices(x.shape, field_height, field_width, padding,</span><br><span class="line">                                 stride)</span><br><span class="line"></span><br><span class="line">    cols = x_padded[:, k, i, j]</span><br><span class="line">    C = x.shape[<span class="number">1</span>]</span><br><span class="line">    cols = cols.transpose(<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>).reshape(field_height * field_width * C, <span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">return</span> cols</span><br></pre></td></tr></table></figure></p>
<p>Even if I've used Python for three years long, It is still something mindblowing for me to understand how it works at first! In order to understand the mechanism of this function. It's time to learn more about the fancy indexing in the Python.</p>
<p>When we implement the Backpropagation of Neural Network, we might see something like this to compute the final Loss function.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loss = some_loss_fun(scores[np.arange(N), target_y])</span><br></pre></td></tr></table></figure>
<p>We know it's to extract the elements of according position out, the output will be (N,). At first you will tend to treat it as a small trick to memorize it and don't care what's going on hehind. But if you start to look at something like this, you will see this index can do things far beyond your thoughts(I also had no idea what it will give me before I ran this code:).)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">59</span>]: k = np.arange(<span class="number">24</span>).reshape(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">60</span>]: k</span><br><span class="line">Out[<span class="number">60</span>]: </span><br><span class="line">array([[[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>],</span><br><span class="line">        [ <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>],</span><br><span class="line">        [ <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>]],</span><br><span class="line"></span><br><span class="line">       [[<span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>],</span><br><span class="line">        [<span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>],</span><br><span class="line">        [<span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>]]])</span><br><span class="line"></span><br><span class="line">In [<span class="number">62</span>]: k[:,np.arange(<span class="number">2</span>),np.arange(<span class="number">2</span>).reshape(<span class="number">-1</span>,<span class="number">1</span>) * np.arange(<span class="number">2</span>) ]</span><br><span class="line">Out[<span class="number">62</span>]:</span><br><span class="line">array([[[ <span class="number">0</span>,  <span class="number">4</span>],</span><br><span class="line">        [ <span class="number">0</span>,  <span class="number">5</span>]],</span><br><span class="line"></span><br><span class="line">       [[<span class="number">12</span>, <span class="number">16</span>],</span><br><span class="line">        [<span class="number">12</span>, <span class="number">17</span>]]])</span><br></pre></td></tr></table></figure>
<p>Actually at the beginning this fancy indexing, Python will try to broadcast the indexing arrays into the same dimension, And a small <strong>caveat</strong> here, broadcasting will always first look for trailing dimensions. In our example, np.arange(2) in this second dimension after broadcasting will become the left one instead of the right one.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[[ <span class="number">0</span>,  <span class="number">1</span>],  right!       [[ <span class="number">0</span>,  <span class="number">0</span>], <span class="comment">#wrong!</span></span><br><span class="line"> [ <span class="number">0</span>,  <span class="number">1</span>]]                [ <span class="number">1</span>,  <span class="number">1</span>]]</span><br></pre></td></tr></table></figure>
<p>And then, it will extract the correspond elements as we might think. Eventually the think will like the outcome we run above.</p>
<p>While writing this, I also find a interesting example in the document of numpy to demonstrate the magic of broadcast. If you have more interest in it. Please click <a href="https://docs.scipy.org/doc/numpy-1.13.0/user/basics.broadcasting.html#general-broadcasting-rules" target="_blank" rel="noopener">here</a>. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A      (<span class="number">4</span>d array):  <span class="number">8</span> x <span class="number">1</span> x <span class="number">6</span> x <span class="number">1</span></span><br><span class="line">B      (<span class="number">3</span>d array):      <span class="number">7</span> x <span class="number">1</span> x <span class="number">5</span></span><br><span class="line">Result (<span class="number">4</span>d array):  <span class="number">8</span> x <span class="number">7</span> x <span class="number">6</span> x <span class="number">5</span></span><br></pre></td></tr></table></figure></p>
<p>Besides, we need to see : is sort of special in the indexing, which means the outcome of these two piece of code will be different.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">77</span>]: k[:,:,np.arange(<span class="number">2</span>).reshape(<span class="number">-1</span>,<span class="number">1</span>) * np.arange(<span class="number">2</span>) ] <span class="comment">#This will give a matrix of shape(2,3,2,2)</span></span><br><span class="line">Out[<span class="number">77</span>]: </span><br><span class="line">array [[[[ <span class="number">0</span>,  <span class="number">0</span>],</span><br><span class="line">         [ <span class="number">0</span>,  <span class="number">1</span>]],</span><br><span class="line"></span><br><span class="line">        [[ <span class="number">4</span>,  <span class="number">4</span>],</span><br><span class="line">         [ <span class="number">4</span>,  <span class="number">5</span>]],</span><br><span class="line"></span><br><span class="line">        [[ <span class="number">8</span>,  <span class="number">8</span>],</span><br><span class="line">         [ <span class="number">8</span>,  <span class="number">9</span>]]],</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       [[[<span class="number">12</span>, <span class="number">12</span>],</span><br><span class="line">         [<span class="number">12</span>, <span class="number">13</span>]],</span><br><span class="line"></span><br><span class="line">        [[<span class="number">16</span>, <span class="number">16</span>],</span><br><span class="line">         [<span class="number">16</span>, <span class="number">17</span>]],</span><br><span class="line"></span><br><span class="line">        [[<span class="number">20</span>, <span class="number">20</span>],</span><br><span class="line">         [<span class="number">20</span>, <span class="number">21</span>]]]])</span><br><span class="line">In [<span class="number">78</span>]: k[:,np.arange(<span class="number">3</span>),np.arange(<span class="number">2</span>).reshape(<span class="number">-1</span>,<span class="number">1</span>) * np.arange(<span class="number">2</span>) ] <span class="comment">#this will give you an error because it can not broadcast properly.</span></span><br></pre></td></tr></table></figure>
<p>With this thorough understanding of Python Fancy Indexing, we will go back and see the intricated implement of im2col.</p>
<p>We first need to examine the dimension of these three outcome indices</p>
<p>k is of shape (C * field_height * field_width, 1) i is of shape (C * field_height * field_width, out_height<em>out_width) j is of shape (C </em> field_height * field_width, out_height*out_width)</p>
<p>So when we use index in <code>x_padded[:, k, i, j]</code>, we are extract out a matrix of 3-D (N, C * field_height * field_width, out_height<em>out_width), the broadcasted index matrix is of dimension (C </em> field_height * field_width, out_height<em>out_width). Remember each neuron in filters in CNN will generally have C </em> field_height * field_width weight on it.</p>
<p>Now it might be clearlier for you to see what's going on here. We will take the first slice of index matrix (C * field_height * field_width, 1), which give you the outcome of first neuron to guide you the whole process. There will be out_height*out_width neurons in a single filter</p>
<p>I will refer to second, third, fourth dimension of x(image) as C, H, W position.</p>
<ol type="1">
<li>The index in the C position tries to traverse different channel, for each channel, there will be field_height * field_width numbers to be used, which indicates how many pixel every neuron try to capture in a single channel. Index will look like this:</li>
</ol>
<p><span class="math display">\[
\underbrace{\underbrace{c,\dots,c}_{length\ of\ F\_H * F\_W } }_{c\ =\ 0,\dots,C-1}
\]</span></p>
<ol start="2" type="1">
<li>The index in the H channel is try to traverse the height of each position in the neural. Due to the fact the implementation will get width-side pixel first. so it will have index like:</li>
</ol>
<p><span class="math display">\[
\underbrace{\underbrace{0,\dots,0}_{length\ of\ F\_W},\dots, \underbrace{F\_H-1,\dots,F\_H-1}_{length\ of\ F\_W} }_{rep\ for\ C\ times}
\]</span></p>
<ol start="3" type="1">
<li>Accordingly,The index in the W channel looks like this:</li>
</ol>
<p><span class="math display">\[
\underbrace{\underbrace{0,1, \dots,F\_W-1}_{F\_H\ times}}_{rep\ for\ C\ times}
\]</span></p>
<p>The <code>i1</code>, <code>j1</code> in function<code>get_im2col_indices</code> is used to tuned the width and height index positionS according to different neurons. Because we also traverse width side first for all neurons in each filter, so we use <code>np.tile</code> for <code>j1</code>(row), <code>np.repeat</code> for <code>i1</code>(column).</p>
<p>By the way, Python always operates first on trailing dimensions. For instance, the reshape will first spread out or gather the row-side in 2-D array:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">84</span>]: np.array(list(range(<span class="number">12</span>))).reshape(<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">Out[<span class="number">84</span>]: </span><br><span class="line">array([[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>],</span><br><span class="line">       [ <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>],</span><br><span class="line">       [ <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment">#instead of </span></span><br><span class="line">array([[ <span class="number">0</span>,  <span class="number">3</span>,  <span class="number">6</span>,  <span class="number">9</span>],</span><br><span class="line">       [ <span class="number">1</span>,  <span class="number">4</span>,  <span class="number">7</span>, <span class="number">10</span>],</span><br><span class="line">       [ <span class="number">2</span>,  <span class="number">5</span>,  <span class="number">8</span>, <span class="number">11</span>]])</span><br></pre></td></tr></table></figure>
<p>Bonus Part: Some tricks regarding numpy I found accidentally:</p>
<ol type="1">
<li>You can use index None to add one more dimension to your np.array with ease. But be careful, the newly created object still get reference to the original one. Revising one will change another!</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">91</span>]: x.shape</span><br><span class="line">Out[<span class="number">91</span>]: (<span class="number">3</span>, <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">92</span>]: x[<span class="keyword">None</span>].shape</span><br><span class="line">Out[<span class="number">92</span>]: (<span class="number">1</span>, <span class="number">3</span>, <span class="number">6</span>)</span><br></pre></td></tr></table></figure>
<p>(To be continued)</p>
<hr>
<p>f you find any mistakes in this passage, feel free to contact me through my email: FDSM_lhn@yahoo.com.</p>
<p>You're welcome to share my passage to other websites or bloggers. <strong>But please add my name and link to this post alongside</strong>. Thank you!</p>

      
    </div>

    

    
    
    

    
      <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center;">
  <img id="wechat_subscriber_qcode" src="/images/wechat_qcode.JPG" alt="Haonan Li wechat" style="width: 200px; max-width: 100%;">
  <div></div>
</div>

    

    
      
    
    

    

    <footer class="post-footer">
      
        
          
        
        <div class="post-tags">
          
            <a href="/tags/hexo/" rel="tag"># hexo</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/10/22/Derivation of Back Propagation Through Time (BPTT) - Vanilla Recurrent Neural Network(RNN)/" rel="next" title="Derivation of Back Propagation Through Time (BPTT) - Vanilla Recurrent Neural Network(RNN)">
                <i class="fa fa-chevron-left"></i> Derivation of Back Propagation Through Time (BPTT) - Vanilla Recurrent Neural Network(RNN)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/02/09/Deep-Residual-Learning-For-Image-Recognition/" rel="prev" title="Deep Residual Learning For Image Recognition">
                Deep Residual Learning For Image Recognition <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/selfie1.JPG" alt="Haonan Li">
            
              <p class="site-author-name" itemprop="name">Haonan Li</p>
              <div class="site-description motion-element" itemprop="description">Strong Mind = Success</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/fdsmlhn" title="GitHub &rarr; https://github.com/fdsmlhn" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:lihaonan@uw.edu" title="E-Mail &rarr; mailto:lihaonan@uw.edu" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 – <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Haonan Li</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.1.2</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.2"></script>

  <script src="/js/motion.js?v=7.1.2"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.2"></script>




  
  <script src="/js/scrollspy.js?v=7.1.2"></script>
<script src="/js/post-details.js?v=7.1.2"></script>



  


  <script src="/js/next-boot.js?v=7.1.2"></script>


  

  

  

  
  
<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://haonanli.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>


<script>
  var disqus_config = function() {
    this.page.url = "http://fdsmlhn.github.io/2017/11/02/Understanding im2col implementation in Python(numpy fancy indexing)/";
    this.page.identifier = "2017/11/02/Understanding im2col implementation in Python(numpy fancy indexing)/";
    this.page.title = 'Understanding im2col implementation in Python(numpy fancy indexing)';
    };
  function loadComments() {
    var d = document, s = d.createElement('script');
    s.src = 'https://haonanli.disqus.com/embed.js';
    s.setAttribute('data-timestamp', '' + +new Date());
    (d.head || d.body).appendChild(s);
  }
  
    window.addEventListener('load', loadComments, false);
  
</script>





  


  




  
  
  <script>
    
    function addCount(Counter) {
      var $visitors = $('.leancloud_visitors');
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url }) })
        .done(function({ results }) {
          if (results.length > 0) {
            var counter = results[0];
            
            Counter('put', '/classes/Counter/' + counter.objectId, JSON.stringify({ time: { '__op': 'Increment', 'amount': 1 } }))
            
              .done(function() {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.time + 1);
              })
            
              .fail(function ({ responseJSON }) {
                console.log('Failed to save Visitor num, with error message: ' + responseJSON.error);
              })
          } else {
            
              Counter('post', '/classes/Counter', JSON.stringify({ title: title, url: url, time: 1 }))
                .done(function() {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(1);
                })
                .fail(function() {
                  console.log('Failed to create');
                });
            
          }
        })
        .fail(function ({ responseJSON }) {
          console.log('LeanCloud Counter Error: ' + responseJSON.code + ' ' + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'zbvuaBisX1AfjuwJMcWO9rzv-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'zbvuaBisX1AfjuwJMcWO9rzv-gzGzoHsz',
                'X-LC-Key': '3b93yKO3H6npVFDdtYKfwSYA',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            addCount(Counter);
          
        });
    });
  </script>



  

  
  

  
  

  
    
      <script type="text/x-mathjax-config">
  

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });
  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') { next = next.nextSibling }
        if (next && next.nodeName.toLowerCase() === 'br') { next.parentNode.removeChild(next) }
      }
    });
  });
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      document.getElementById(all[i].inputID + '-Frame').parentNode.className += ' has-jax';
    }
  });
</script>
<script src="//cdn.staticfile.org/MathJax/MathJax-2.6-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    
  


  

  

  

  

  

  

  

  

  
<script>
  $('.highlight').not('.gist .highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      const selection = document.getSelection();
      const selected = selection.rangeCount > 0 ? selection.getRangeAt(0) : false;
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
      ta.blur(); // For iOS
      $(this).blur();
      if (selected) {
        selection.removeAllRanges();
        selection.addRange(selected);
      }
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('复制');
      }, 300);
    }).append(e);
  })
</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src>
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->


  

  

</body>
</html>
